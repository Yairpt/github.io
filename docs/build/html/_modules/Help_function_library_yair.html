

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Help_function_library_yair &mdash; Wave_Function_Propagation 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Wave_Function_Propagation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">WaveFunctionPropagation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module Descriptor:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Manual.html">Manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Wave_Function_Propagation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>Help_function_library_yair</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Help_function_library_yair</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Nov 22 18:17:17 2021</span>
<span class="sd">@author: Yair Reichman</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">PCG64</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">smp</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;TkAgg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">I</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">conjugate</span><span class="p">,</span> <span class="n">lambdify</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">nps</span>
<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span><span class="p">,</span> <span class="n">fftfreq</span><span class="p">,</span> <span class="n">fft2</span><span class="p">,</span> <span class="n">ifft2</span><span class="p">,</span> <span class="n">fftshift</span><span class="p">,</span> <span class="n">ifftshift</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">PchipInterpolator</span> <span class="k">as</span> <span class="n">pchip</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span> <span class="k">as</span> <span class="n">lin_reg</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span> <span class="k">as</span> <span class="n">cfit</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">peak_widths</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span><span class="p">,</span> <span class="n">cumulative_trapezoid</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">Locpot_class</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FormatStrFormatter</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp.outputs</span> <span class="kn">import</span> <span class="n">Locpot</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Lattice</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">ss</span>
<span class="kn">from</span> <span class="nn">savitzky_golay</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Locpot_class</span> <span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="Constants"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants">[docs]</a><span class="k">class</span> <span class="nc">Constants</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class that aims to handle constants and unit conversion.</span>
<span class="sd">    Sometimes it implemented as an instance attribute, and it appears at the initiation function, then</span>
<span class="sd">    it can be called as : &lt;instance&gt;.cons</span>
<span class="sd">    Other times it imported as an outer scope instance of the Constants class and then treated as</span>
<span class="sd">    just a class varibale.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eVA</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbareV</span> <span class="o">=</span> <span class="mf">6.58212e-16</span>  <span class="c1"># [eV*s/rad]or</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbarJ</span> <span class="o">=</span> <span class="mf">6.62607e-34</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># [J*sec/rad]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">me</span> <span class="o">=</span> <span class="mf">9.10938e-31</span>  <span class="c1"># [kg] electron mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qe</span> <span class="o">=</span> <span class="mf">1.6021766e-19</span>  <span class="c1"># electron charge[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eVA</span> <span class="o">=</span> <span class="n">eVA</span>

<div class="viewcode-block" id="Constants.set_eVA"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.set_eVA">[docs]</a>    <span class="k">def</span> <span class="nf">set_eVA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eVA</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eVA</span> <span class="o">=</span> <span class="n">eVA</span></div>

<div class="viewcode-block" id="Constants.eV2J"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.eV2J">[docs]</a>    <span class="k">def</span> <span class="nf">eV2J</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ener_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ener_value : float</span>
<span class="sd">            gets energy value in eV.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Float</span>
<span class="sd">            returns energy value in J.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.6021765e-19</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.6021765e-19</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">))</span></div>

<div class="viewcode-block" id="Constants.J2eV"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.J2eV">[docs]</a>    <span class="k">def</span> <span class="nf">J2eV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ener_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ener_value : float</span>
<span class="sd">            gets energy value in J.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Float</span>
<span class="sd">            returns energy value in eV.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">6.241509596e+18</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">6.241509596e+18</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ener_value</span><span class="p">))</span></div>

<div class="viewcode-block" id="Constants.A2m"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.A2m">[docs]</a>    <span class="k">def</span> <span class="nf">A2m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conver_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conver_value : float</span>
<span class="sd">            Gets metric value in A.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            returns metric value in m.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Constants.m2A"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.m2A">[docs]</a>    <span class="k">def</span> <span class="nf">m2A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conver_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        conver_value : float</span>
<span class="sd">            Gets metric value in m.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            returns metric value in A.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e+10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e+10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Constants.sec2fs"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.sec2fs">[docs]</a>    <span class="k">def</span> <span class="nf">sec2fs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conver_value</span><span class="p">):</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">23</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e+15</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">23</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e+15</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Constants.fs2sec"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.Constants.fs2sec">[docs]</a>    <span class="k">def</span> <span class="nf">fs2sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conver_value</span><span class="p">):</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">conver_value</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">23</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e-15</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">23</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span> <span class="o">*</span> <span class="mf">1e-15</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">conver_value</span><span class="p">)</span></div></div>


<span class="c1"># Here is an example for an outter scope varibale of Constants class instance</span>
<span class="c1"># that will be used along this document.</span>
<span class="n">cons</span> <span class="o">=</span> <span class="n">Constants</span><span class="p">()</span>

<div class="viewcode-block" id="to_1D_vec"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.to_1D_vec">[docs]</a><span class="k">def</span> <span class="nf">to_1D_vec</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vec : np.array</span>
<span class="sd">        This method enforce any 1D vector in any form into the shape of 1D vector in the shpae of (n,)</span>
<span class="sd">        while n is the number of rows. Pay attention that there is no another axis, and all opertations</span>
<span class="sd">        such as tranpose does not take any action on the resulted vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        The original vector in a form of a 1D vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="ow">in</span> <span class="n">types</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You have another not negligible axis&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vec</span></div>

<div class="viewcode-block" id="find_peak_half_max_width"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_peak_half_max_width">[docs]</a><span class="k">def</span> <span class="nf">find_peak_half_max_width</span><span class="p">(</span><span class="n">locpot_vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    locpot_vec : `numpy.ndarray`, (N,2)</span>
<span class="sd">        Gets a 2d matrix with two columns represents [:,0] = positions\coords,</span>
<span class="sd">        and [:,1] represents the potential values (v(z)).</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    flaot</span>
<span class="sd">        It returns the average width of the peaks.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">locpot_vec</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">locpot_vec</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">allmax</span> <span class="o">=</span> <span class="n">find_peaks_maxima</span><span class="p">(</span><span class="n">locpot_vec</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">locpot_vec</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span><span class="n">ignore_local_maxima</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">maxima</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="k">if</span> <span class="n">peaks</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">allmax</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="n">peak_widths</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">maxima</span><span class="p">,</span> <span class="n">rel_height</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">wid</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span></div>

<div class="viewcode-block" id="to_column_vec"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.to_column_vec">[docs]</a><span class="k">def</span> <span class="nf">to_column_vec</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    As oppose the to_1D_vec method, this function do the opposite, it</span>
<span class="sd">    enforce any 1D or a column vector into column vector in the form (n,1)</span>
<span class="sd">    where n is the number of rows. Pay attention that here we hve addtitonal</span>
<span class="sd">    axis where we can perform an actions like traspose.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vec : np.array</span>
<span class="sd">        The original vector we wish convert into a column vector</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        The original vector in a form of a coulmn vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">vec</span></div>

<div class="viewcode-block" id="to_row_vec"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.to_row_vec">[docs]</a><span class="k">def</span> <span class="nf">to_row_vec</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Similar to to_column_vec but it enforces the original vector into</span>
<span class="sd">    a row vector of the form (1,n) where n is the number of columns here.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vec : np.array</span>
<span class="sd">        The original vector we wish convert into a row vector</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        The original vector in a form of a row vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">vec</span></div>

<div class="viewcode-block" id="find_peaks"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_peaks">[docs]</a><span class="k">def</span> <span class="nf">find_peaks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">to_plot</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array, array_like</span>
<span class="sd">        The Spatial coordinates vector.</span>
<span class="sd">    y : np.array, array_like</span>
<span class="sd">       The functional values of the spatial coordiantes vector. The definiion for `f(x) = y`. Usually will be the local potential vector.</span>
<span class="sd">    to_plot : bool, optional, default: False</span>
<span class="sd">        Flag that determines whether to enable plotting or not.</span>
<span class="sd">    dist : float, optional, default: None</span>
<span class="sd">        The distance between peaks.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `numpy.ndarray`</span>
<span class="sd">        It returns a matrix of two columns. The first column is for the peaks position, and the second column is for and their heights. It also can plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">global_max_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">global_min_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">,</span><span class="n">distance</span><span class="o">=</span><span class="n">dist</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">)</span>
    <span class="n">min_pos</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the minima positions</span>
    <span class="n">min_height</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the mirrored minima heights</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="n">global_min_y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">global_max_y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">dist</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="n">global_min_y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">global_max_y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;peak_heights&#39;</span><span class="p">]</span>  <span class="c1"># list of the heights of the peaks</span>
    <span class="n">peak_pos</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the peaks positions</span>

    <span class="n">peaks_array_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak_pos</span><span class="p">,</span> <span class="n">min_pos</span><span class="p">)</span>
    <span class="n">peaks_array_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">peaks_array_pos</span><span class="p">)</span>
    <span class="n">peaks_array_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">peaks_array_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">peaks_array_height</span><span class="p">)</span>
    <span class="n">peaks_array_height</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">peaks_array_height</span><span class="p">]</span>
    <span class="n">peaks_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">peaks_array_pos</span><span class="p">,</span> <span class="n">peaks_array_height</span><span class="p">])</span>
    <span class="n">peaks_array</span> <span class="o">=</span> <span class="n">to_2_column_mat</span><span class="p">(</span><span class="n">peaks_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">to_plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peaks_array_pos</span><span class="p">,</span> <span class="n">peaks_array_height</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">peaks_array</span></div>

<div class="viewcode-block" id="find_peaks_maxima"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_peaks_maxima">[docs]</a><span class="k">def</span> <span class="nf">find_peaks_maxima</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ignore_local_maxima</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">to_plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">prominence</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array, array_like</span>
<span class="sd">        spatial coordinates vector.</span>
<span class="sd">    y : np.array, array_like</span>
<span class="sd">        Potential values v(z) vector.</span>
<span class="sd">    ignore_local_maxima : bool, optional, default: False</span>
<span class="sd">        It enables to turn on the option to ignore local maxima points.</span>
<span class="sd">    to_plot : bool, optional, default: False</span>
<span class="sd">        Flag that determines whether to enable plotting or not.</span>
<span class="sd">    prominence : float, optional, the default is None</span>
<span class="sd">        Input to detemine the prominence threshold for the find_peak.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `numpy.ndarray`</span>
<span class="sd">        It returns a matrix of the maximum peaks. The first column is the maximum peaks position. The second column is the</span>
<span class="sd">        maximum peaks height. It also can plot.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">flag_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">flag_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">window</span><span class="o">*</span><span class="mf">0.0000001</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">window</span> <span class="o">*=</span><span class="mi">10</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">r_sqrd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_temp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.85</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y_temp</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">r_sqrd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_temp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.85</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y_temp</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">iteration</span> <span class="o">+=</span><span class="mi">1</span>
    <span class="n">global_max_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">global_min_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_local_maxima</span><span class="p">:</span>
         <span class="n">maxima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="n">global_min_y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">global_max_y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">prominence</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxima_temp</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prominence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">promin</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">peak_prominences</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">maxima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">peaks_1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">temp_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">maxima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">0.12</span><span class="p">:</span>
                        <span class="n">temp_flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">temp_flag</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">promin_max</span> <span class="o">=</span> <span class="mf">0.1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span>  <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Chceck Your input vectors&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                         <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mf">0.2</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">promin_max</span> <span class="o">=</span> <span class="mf">0.1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span>  <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Chceck Your input vectors&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">promin_max</span> <span class="o">=</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">peaks_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">maxima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)</span><span class="o">-</span> <span class="mf">0.2</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_x</span><span class="p">:</span>
        <span class="n">maxima_pos</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">maxima</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># list of the minima positions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxima_pos</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">maxima</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the minima positions</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_y</span><span class="p">:</span>
        <span class="n">max_height</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxima</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># list of the mirrored minima heights</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_height</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">maxima</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the mirrored minima heights</span>
    <span class="n">peaks_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">maxima_pos</span><span class="p">,</span> <span class="n">max_height</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">peaks_array</span></div>

<div class="viewcode-block" id="get_prominence"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.get_prominence">[docs]</a><span class="k">def</span> <span class="nf">get_prominence</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">num_of_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">is_max</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z : np.array, array_like</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    v : np.array, array_like</span>
<span class="sd">       The potential values (v(z)) vector</span>
<span class="sd">    num_of_min : int, optional, default : None</span>
<span class="sd">        Input to detemine how many kind of minima&#39;s we have in our system.</span>
<span class="sd">    is_max : bool, optional, default : None</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `int`</span>
<span class="sd">        The prominence of out system regarding the main number of minima&#39;s.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_max</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">flag_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_y</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">minima_temp</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">promin</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">peak_prominences</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">peaks_1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">0.12</span><span class="p">:</span>
                <span class="n">temp_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">temp_flag</span><span class="p">:</span>
            <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
                <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">promin_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">promin_max</span> <span class="o">=</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">peaks_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num_of_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
                <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">promin_max</span><span class="p">]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">promin_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">num_of_min</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
                <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">promin_max</span><span class="p">]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;you had an issue with the promincence&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_y</span><span class="p">:</span>
            <span class="n">promin_max</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">promin_max</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_y</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span><span class="n">promin_max</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">promin_max</span></div>

<div class="viewcode-block" id="find_peaks_minima"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_peaks_minima">[docs]</a><span class="k">def</span> <span class="nf">find_peaks_minima</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ignore_local_minima</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">to_plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array, array_like</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    y : np.array, array_like</span>
<span class="sd">       The potential values (v(z)) vector</span>
<span class="sd">    ignore_local_minima : bool, optional, default: False</span>
<span class="sd">       It enables to turn on the option to ignore local minima points.</span>
<span class="sd">    to_plot : bool, optional, default: False</span>
<span class="sd">        This is a flag that determines whether to enable plotting or not.</span>
<span class="sd">    prominence : float, optional, the default is None</span>
<span class="sd">        Input to detemine the prominence threshold for the find_peak.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `numpy.ndarray`</span>
<span class="sd">        It returns a matrix of the minimum peaks. The first column is the minimum peaks position. The second column is the</span>
<span class="sd">        minimum peaks height. It also can plot.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">flag_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">flag_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">window</span><span class="o">*</span><span class="mf">0.0000001</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">window</span> <span class="o">*=</span><span class="mi">10</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">r_sqrd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_temp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.85</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y_temp</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">+=</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">y_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">r_sqrd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_temp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.85</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y_temp</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">+=</span><span class="mi">2</span>
        <span class="n">iteration</span> <span class="o">+=</span><span class="mi">1</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">global_min_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_y</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_local_minima</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flag_y</span><span class="p">:</span>
            <span class="n">minima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minima_temp</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prominence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">promin</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">peak_prominences</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">peaks_1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">temp_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">minima_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">0.12</span><span class="p">:</span>
                        <span class="n">temp_flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">temp_flag</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">promin_max</span> <span class="o">=</span> <span class="mf">0.1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Chceck Your input vectors&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">promin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mf">0.2</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">promin_max</span> <span class="o">=</span> <span class="mf">0.1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Chceck Your input vectors&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">promin_max</span> <span class="o">=</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">peaks_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="mf">0.2</span>

            <span class="n">minima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">promin_max</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minima</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_x</span><span class="p">:</span>
        <span class="n">min_pos</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># list of the minima positions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_pos</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the minima positions</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_y</span><span class="p">:</span>
        <span class="n">min_height</span> <span class="o">=</span><span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">y2</span><span class="p">[</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># list of the mirrored minima heights</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_height</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">y2</span><span class="p">[</span><span class="n">minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># list of the mirrored minima heights</span>

    <span class="c1"># peaks = ss.find_peaks(y,height = [global_min_y-0.5,global_max_y+0.5])</span>
    <span class="c1"># height = peaks[1][&#39;peak_heights&#39;] #list of the heights of the peaks</span>
    <span class="c1"># peak_pos = x[peaks[0]] #list of the peaks positions</span>

    <span class="c1"># peaks_array_pos = np.array(peak_pos)</span>
    <span class="c1"># peaks_array_pos = np.sort(peaks_array_pos)</span>
    <span class="c1"># peaks_array_height = np.array(peaks[0])</span>
    <span class="c1"># peaks_array_height = np.sort(peaks_array_height)</span>
    <span class="c1"># peaks_array_height = y[peaks_array_height]</span>
    <span class="n">peaks_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">min_pos</span><span class="p">,</span> <span class="n">min_height</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">to_plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">min_pos</span><span class="p">,</span> <span class="n">min_height</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">peaks_array</span></div>

<div class="viewcode-block" id="create_k_grid"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.create_k_grid">[docs]</a><span class="k">def</span> <span class="nf">create_k_grid</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int/float</span>
<span class="sd">        The number of measuerment sample. The number of the k-grid points.</span>
<span class="sd">    L : int/float</span>
<span class="sd">         The actual length of the system. Should be given in units of [m].</span>
<span class="sd">    dimention : str, {&#39;1D&#39;, &#39;2D&#39;}, optional, default: &#39;1D&#39;</span>
<span class="sd">        The choices are in the brackets. It defines the K-grid for 1D or 2D mesh.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    K grid vector. Column vector. (numpy array with a shape of (N,1))</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">dimention</span> <span class="o">==</span> <span class="s1">&#39;1D&#39;</span><span class="p">:</span>
        <span class="n">deltak</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># N is odd</span>
            <span class="n">kk2_indice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kk1_indice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(((</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kk2</span> <span class="o">=</span> <span class="n">kk2_indice</span> <span class="o">*</span> <span class="n">deltak</span>
            <span class="n">kk1</span> <span class="o">=</span> <span class="n">kk1_indice</span> <span class="o">*</span> <span class="n">deltak</span>
            <span class="c1"># kk = np.append(kk1,kk2) # this is in the case that x=[-L/2,L/2] and not as it is in our case: L=[0,L]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># N is even</span>
            <span class="n">kk2_indice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="o">-</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kk1_indice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kk2</span> <span class="o">=</span> <span class="n">kk2_indice</span> <span class="o">*</span> <span class="n">deltak</span>
            <span class="n">kk1</span> <span class="o">=</span> <span class="n">kk1_indice</span> <span class="o">*</span> <span class="n">deltak</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kk1</span><span class="p">,</span> <span class="n">kk2</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span><span class="p">,</span> <span class="s1">&#39;length of N = </span><span class="si">{}</span><span class="s1"> and length of kk </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">kk</span><span class="p">))</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">kk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">kk</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">kk</span>

    <span class="k">elif</span> <span class="n">dimention</span> <span class="o">==</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;yet to be programmed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The input should be relating the dimentions order as &quot;1D&quot;</span><span class="se">\</span>
<span class="s1">              for 1 dimention and as &quot;2D&quot; for the two dimentions&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="normalize_wave_function_numerically"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.normalize_wave_function_numerically">[docs]</a><span class="k">def</span> <span class="nf">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">wave_function</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z : np.array, array_like</span>
<span class="sd">        The spatial coordinates vector where the wave function spreads.</span>
<span class="sd">    wave_function : np.array, array_like</span>
<span class="sd">        The complex values of the wave function in at the relevant z positions.</span>
<span class="sd">    units : str, {&#39;Meter&#39;, &#39;Angstrum&#39;], optioanl, default: &#39;Meter&#39;</span>
<span class="sd">         The choices are in the brackets. It defines the units of the normilization factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A : flaat</span>
<span class="sd">        The numeric normaliztion factor.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">wave_function</span> <span class="o">=</span> <span class="n">force_psi_units</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    <span class="n">max_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">wave_function</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Meter&#39;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">wave_function</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">3.65</span><span class="p">:</span>
             <span class="n">wave_function</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wave_function</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span>
        <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">wave_function</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">wave_function</span><span class="p">),</span> <span class="n">z</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integral</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Angstrum&#39;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
             <span class="n">wave_function</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-10</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">3.65</span><span class="p">:</span>
             <span class="n">wave_function</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wave_function</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span>
        <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">wave_function</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">wave_function</span><span class="p">),</span> <span class="n">z</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integral</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter the units correctly.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span></div>

<div class="viewcode-block" id="normalize_wave_function"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.normalize_wave_function">[docs]</a><span class="k">def</span> <span class="nf">normalize_wave_function</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">,</span> <span class="n">bound_up</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">bound_down</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave_equation : lambda</span>
<span class="sd">        It is in a lambda function format. It can be a static function or a lambda state.</span>
<span class="sd">        The equation of the wave function we wish to normalize. In this project, mainly supplied as</span>
<span class="sd">        a gaussian wave function.</span>
<span class="sd">    bound_up : int/float, optional, default: smp.oo</span>
<span class="sd">        The intgration boundaries. (default = inifinity)</span>
<span class="sd">    bound_down : int/float, optional, default: -smp.oo</span>
<span class="sd">        The intgration boundaries. (default = -inifinity)</span>
<span class="sd">    units : str, {&#39;Meter&#39;, &#39;Angstrum&#39;], optioanl, default: &#39;Meter&#39;</span>
<span class="sd">         The choices are in the brackets. It defines the units of the normilization factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A : int/float</span>
<span class="sd">        The normalization factor. Where psi(x) = A*f(x) -&gt; it returns A.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">integrand_real</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span>
    <span class="n">integrand_img</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span>
    <span class="n">val_int_real</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand_real</span><span class="p">,</span> <span class="n">bound_down</span><span class="p">,</span> <span class="n">bound_up</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">val_int_img</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand_img</span><span class="p">,</span> <span class="n">bound_down</span><span class="p">,</span> <span class="n">bound_up</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">integral_val</span> <span class="o">=</span> <span class="n">val_int_real</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">val_int_img</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integral_val</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Meter&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span>  <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">3.65</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="mf">1E5</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Angstrum&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span>  <span class="o">*</span> <span class="mf">1E-10</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">3.65</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="mf">1E-5</span>
    <span class="k">return</span> <span class="n">A</span></div>

<div class="viewcode-block" id="normalize_wave_function_sym"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.normalize_wave_function_sym">[docs]</a><span class="k">def</span> <span class="nf">normalize_wave_function_sym</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">,</span> <span class="n">bound_up</span><span class="o">=</span><span class="n">smp</span><span class="o">.</span><span class="n">oo</span><span class="p">,</span> <span class="n">bound_down</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave_equation : lambda</span>
<span class="sd">        It is in a lambda function format. It can be a static function or a lambda state.</span>
<span class="sd">        The equation of the wave function we wish to normalize. In this project, mainly supplied as</span>
<span class="sd">        a gaussian wave function.</span>
<span class="sd">    bound_up : int/float, optional, default: smp.oo</span>
<span class="sd">        The intgration boundaries. (default = inifinity)</span>
<span class="sd">    bound_down : int/float, optional, default: -smp.oo</span>
<span class="sd">        The intgration boundaries. (default = -inifinity)</span>
<span class="sd">    units : str, {&#39;Meter&#39;, &#39;Angstrum&#39;], optioanl, default: &#39;Meter&#39;</span>
<span class="sd">         The choices are in the brackets. It defines the units of the normilization factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A : float</span>
<span class="sd">        The symbolic normaliztion factor.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">integrand_real</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">re</span><span class="p">(</span><span class="n">wave_equation</span> <span class="o">*</span> <span class="n">smp</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">))</span>
    <span class="n">integrand_img</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">im</span><span class="p">(</span><span class="n">wave_equation</span> <span class="o">*</span> <span class="n">smp</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">wave_equation</span><span class="p">))</span>
    <span class="n">val_int_real</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">integrand_real</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bound_down</span><span class="p">,</span> <span class="n">bound_up</span><span class="p">))</span>
    <span class="n">val_int_img</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">integrand_img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bound_down</span><span class="p">,</span> <span class="n">bound_up</span><span class="p">))</span>
    <span class="n">integral_val</span> <span class="o">=</span> <span class="n">val_int_real</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">val_int_img</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">smp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integral_val</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Meter&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span>  <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">3.65</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="mf">1E5</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Angstrum&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span>  <span class="o">*</span> <span class="mf">1E-10</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">3.65</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="mf">1E-5</span>
    <span class="k">return</span> <span class="n">A</span></div>

<div class="viewcode-block" id="is_normalized"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.is_normalized">[docs]</a><span class="k">def</span> <span class="nf">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">psi_values</span><span class="p">,</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z : np.array, array_like</span>
<span class="sd">        The spatial coordinates the wave function is specified at.</span>
<span class="sd">    psi_values : np.array, array_like</span>
<span class="sd">        The wavefunction values along the spatial coordinates. Must suit the units for angstrums.</span>
<span class="sd">    units : str, {&#39;Meter&#39;, &#39;Angstrum&#39;], optioanl, default: &#39;Meter&#39;</span>
<span class="sd">         The choices are in the brackets. It defines the units of the normilization factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        It checks if the wave function is normalized, True if it does, atherwise it returns False.</span>
<span class="sd">        It performs numerical integrarion and checks if it to be equal to 1.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">max_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">psi_values</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Meter&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
             <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi_values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">3.65</span><span class="p">:</span>
             <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi_values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi_values</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Angstrum&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
             <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi_values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-10</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">3.65</span><span class="p">:</span>
             <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi_values</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="mf">0.95</span> <span class="o">&lt;=</span> <span class="n">integral</span> <span class="o">&lt;=</span> <span class="mf">1.05</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="gaussian_function_sym"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.gaussian_function_sym">[docs]</a><span class="k">def</span> <span class="nf">gaussian_function_sym</span><span class="p">(</span> <span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k0 : float</span>
<span class="sd">        The initial momentum value,</span>
<span class="sd">    sigma : float</span>
<span class="sd">        The standard devaiation of the gaussian wave-function.</span>
<span class="sd">    z0 : float</span>
<span class="sd">        Initial poisition where the wave function is centered at.</span>
<span class="sd">    dimention : str, {&#39;1D&#39;, &#39;2D&#39;}, optional, default: &#39;1D&#39;</span>
<span class="sd">        The choices are in the brackets. It defines the K-grid for 1D or 2D mesh.</span>
<span class="sd">    A : float, optional, default: None</span>
<span class="sd">        If we already calculated the normaliztion factor we can supply it here.</span>
<span class="sd">        Otherwise it calculate from scratch here.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lambda</span>
<span class="sd">        It returns a symbolic expression of the wavefunction, in lambda format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># return np.exp(-(((x-z0)**2)/(2*(sigma**2)))+1j*k0*x)</span>
        <span class="k">return</span> <span class="n">smp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">k0</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">smp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">smp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">k0</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="gaussian_function"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.gaussian_function">[docs]</a><span class="k">def</span> <span class="nf">gaussian_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    k0 : float</span>
<span class="sd">        The initial momentum value,</span>
<span class="sd">    sigma : float</span>
<span class="sd">        The standard devaiation of the gaussian wave-function.</span>
<span class="sd">    z0 : float</span>
<span class="sd">        Initial poisition where the wave function is centered at.</span>
<span class="sd">    dimention : str, {&#39;1D&#39;, &#39;2D&#39;}, optional, default: &#39;1D&#39;</span>
<span class="sd">        The choices are in the brackets. It defines the K-grid for 1D or 2D mesh.</span>
<span class="sd">    A : float, optional, default: None</span>
<span class="sd">        If we already calculated the normaliztion factor we can supply it here.</span>
<span class="sd">        Otherwise it calculate from scratch here.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        The wave function vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># return np.exp(-(((x-z0)**2)/(2*(sigma**2)))+1j*k0*x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">k0</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">k0</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_psi0"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.get_psi0">[docs]</a><span class="k">def</span> <span class="nf">get_psi0</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">sqrd_psi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">units</span><span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k0 : float</span>
<span class="sd">        The initial momentum value,</span>
<span class="sd">    sigma : float</span>
<span class="sd">        The standard devaiation of the gaussian wave-function.</span>
<span class="sd">    z0 : float</span>
<span class="sd">        Initial poisition where the wave function is centered at.</span>
<span class="sd">    dimention : str, {&#39;1D&#39;, &#39;2D&#39;}, optional, default: &#39;1D&#39;</span>
<span class="sd">        The choices are in the brackets. It defines the K-grid for 1D or 2D mesh.</span>
<span class="sd">    sqrd_psi : bool, optional, default: False</span>
<span class="sd">        It gives an optiona to return also the absolute sqrd of the wave function.</span>
<span class="sd">    units : str, {&#39;Meter&#39;, &#39;Angstrum&#39;], optioanl, default: &#39;Meter&#39;</span>
<span class="sd">         The choices are in the brackets. It defines the units of the normilization factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        The first vector represents the spatial coordinates grid</span>
<span class="sd">        and the second vector represnts the wave function value at this position. the values are complex numbers.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">dimention</span> <span class="o">==</span> <span class="s1">&#39;1D&#39;</span><span class="p">:</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z0</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
        <span class="n">k0</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">k0</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">wave_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">gaussian_function</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">normalize_wave_function</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span><span class="n">bound_up</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Angstrum&#39;</span><span class="p">:</span>
            <span class="n">wave_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">gaussian_function</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">)</span>
            <span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
            <span class="c1"># if not np.abs(np.abs(np.average(np.real(psi0[0:5]))) - np.abs(np.average(np.real(psi0[-6:-1])))) &lt; 1E-5:</span>
            <span class="c1">#     print(&#39;Your wave fucntion is not symmetric in the given range&#39;)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sqrd_psi</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Meter&#39;</span><span class="p">:</span>
            <span class="n">z0</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z0</span><span class="p">)</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
            <span class="n">k0</span> <span class="o">=</span> <span class="n">k0</span> <span class="o">*</span> <span class="mf">1E10</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">wave_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">gaussian_function</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">dimention</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">)</span>
            <span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>

            <span class="c1"># if not np.abs(np.abs(np.average(np.real(psi0[0:5]))) - np.abs(np.average(np.real(psi0[-6:-1])))) &lt; 1E-5:</span>
            <span class="c1">#     print(&#39;Your wave fucntion is not symmetric in the given range&#39;)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sqrd_psi</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">A</span> <span class="o">*</span> <span class="n">psi0</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dimention</span> <span class="o">==</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;yet to be programmed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The input should be relating the dimentions order as &quot;1D&quot;</span><span class="se">\</span>
<span class="s1">              for 1 dimention and as &quot;2D&quot; for the two dimentions&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_first_derivative_fft"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.get_first_derivative_fft">[docs]</a><span class="k">def</span> <span class="nf">get_first_derivative_fft</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The appropriate function-values corresponds the spatial coordinates vector.</span>
<span class="sd">    L : float, optional, default: None</span>
<span class="sd">        It should be supplied with the length of the system. It stands for the creation of the K-grid vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        It returns the spatial coordinates vector and the first derivative vecotr.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">create_k_grid</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">to_column_vec</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">fft_x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">fft_x</span> <span class="o">=</span> <span class="n">to_column_vec</span><span class="p">(</span><span class="n">fft_x</span><span class="p">)</span>
    <span class="n">fft_x_k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">fft_x</span><span class="p">)</span>
    <span class="n">fft_x_k</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">fft_x_k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">fft_x_k</span><span class="p">))</span></div>

<div class="viewcode-block" id="get_second_derivative_fft"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.get_second_derivative_fft">[docs]</a><span class="k">def</span> <span class="nf">get_second_derivative_fft</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The appropriate function-values corresponds the spatial coordinates vector.</span>
<span class="sd">    L : float, optional, default: None</span>
<span class="sd">        It should be supplied with the length of the system. It stands for the creation of the K-grid vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        It returns the spatial coordinates vector and the second derivative vecotr.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">create_k_grid</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">fft_x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">fft_x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">fft_x</span><span class="p">)</span>
    <span class="n">fft_x_k</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">fft_x</span>
    <span class="n">fft_x_k</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">fft_x_k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">fft_x_k</span><span class="p">))</span></div>

<div class="viewcode-block" id="get_first_derivative"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.get_first_derivative">[docs]</a><span class="k">def</span> <span class="nf">get_first_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Numerical derivative</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The appropriate function-values corresponds the spatial coordinates vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        It returns the spatial coordinates vector and the first derivative vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">real_part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">imag_part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">real_part</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imag_part</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_second_derivative"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.get_second_derivative">[docs]</a><span class="k">def</span> <span class="nf">get_second_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Numerical derivative</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The appropriate function-values corresponds the spatial coordinates vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        It returns the spatial coordinates vector and the second derivative vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">real_part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">imag_part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">real_part</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imag_part</span><span class="p">)</span></div>

<div class="viewcode-block" id="interpolate_pchip"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.interpolate_pchip">[docs]</a><span class="k">def</span> <span class="nf">interpolate_pchip</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    The interpolant uses monotonic cubic splines to find the value of new points.</span>
<span class="sd">    (PCHIP stands for Piecewise Cubic Hermite Interpolating Polynomial).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int/float</span>
<span class="sd">        It rerpesents the number of the desired samples.</span>
<span class="sd">    *args :  `numpy.ndarray` (N, 2)/ np.array, np.array</span>
<span class="sd">        It the first column is for the coords vector, and the second column is for the potential. It can handle an input</span>
<span class="sd">        in the form of a 2-column matrix or two different array_like arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_coords : np.array,(n,)</span>
<span class="sd">        It is the bew coords divided into the number of the N partition given as input.</span>
<span class="sd">    v : np.array (n,)</span>
<span class="sd">        It is the new potential divided into the number of the N partitiongiven as an input.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">args</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">args</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check again your input&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Check your input structure&#39;</span><span class="p">)</span>
    <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">N</span><span class="p">)</span>
    <span class="n">new_coords</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">pchip</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">new_original_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">new_original_coords</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">new_original_coords</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">pchip</span><span class="p">(</span><span class="n">new_original_coords</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">z</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">interpolate_pchip</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">new_coords</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">z</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please Check your interpolation&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_coords</span><span class="p">,</span> <span class="n">v</span></div>

<div class="viewcode-block" id="interpolate_cubic"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.interpolate_cubic">[docs]</a><span class="k">def</span> <span class="nf">interpolate_cubic</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Cubic interpolation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int/float</span>
<span class="sd">        It rerpesents the number of the desired samples.</span>
<span class="sd">    *args :  `numpy.ndarray` (N, 2)/ np.array, np.array</span>
<span class="sd">        It the first column is for the coords vector, and the second column is for the potential. It can handle an input</span>
<span class="sd">        in the form of a 2-column matrix or two different array_like arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_coords : np.array,(n,)</span>
<span class="sd">        It is the bew coords divided into the number of the N partition given as input.</span>
<span class="sd">    v : np.array (n,)</span>
<span class="sd">        It is the new potential divided into the number of the N partitiongiven as an input.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check again your input&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># coords = np.squeeze(coords)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">N</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span>
    <span class="n">interp_c</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
    <span class="n">new_v</span> <span class="o">=</span> <span class="n">interp_c</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">new_coords</span><span class="p">),</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">new_v</span><span class="p">)</span></div>

<div class="viewcode-block" id="potential_expectation_nadav"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.potential_expectation_nadav">[docs]</a><span class="k">def</span> <span class="nf">potential_expectation_nadav</span><span class="p">(</span><span class="n">psi0_values</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi0_values : np.array</span>
<span class="sd">        The wave-function values in a vector.</span>
<span class="sd">    dx : float</span>
<span class="sd">        The spatial grid spacing.</span>
<span class="sd">    v : np.array</span>
<span class="sd">        The local potential vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        It returns the value of the Potential Energy expectation value.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">psi0</span> <span class="o">=</span> <span class="n">psi0_values</span>
    <span class="n">psi0</span> <span class="o">=</span> <span class="n">force_psi_units</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;Meter&#39;</span><span class="p">)</span>
    <span class="n">Vexp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">psi0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi0</span><span class="p">))</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Vexp</span><span class="p">)</span></div>

<div class="viewcode-block" id="kinetic_energy_operator"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.kinetic_energy_operator">[docs]</a><span class="k">def</span> <span class="nf">kinetic_energy_operator</span><span class="p">(</span><span class="n">psi0_values</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi0_values : np.array</span>
<span class="sd">        The wave-function values in a vector.</span>
<span class="sd">    z : float</span>
<span class="sd">        The spatial grid vector.</span>
<span class="sd">    L : float, optional, default: None</span>
<span class="sd">        The length of the system. if not suuplied it is calculated as</span>
<span class="sd">        the difference between the last value of z and its first value. L=z[-1]-z[0]</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        It returns a vector of the results that comes after operates the kinetic energy operator on the wave-function vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi0_values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">create_k_grid</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">fft_x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">fft_x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">fft_x</span><span class="p">)</span>
    <span class="n">fft_x_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">cons</span><span class="o">.</span><span class="n">hbarJ</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cons</span><span class="o">.</span><span class="n">me</span><span class="p">))</span> <span class="o">*</span> <span class="n">fft_x</span>
    <span class="n">fft_x_k</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">fft_x_k</span><span class="p">)</span>
    <span class="n">kinetic_energy_operator_vec</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">fft_x_k</span><span class="p">)</span>
    <span class="n">kinetic_energy_operator_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">kinetic_energy_operator_vec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_column_vec</span><span class="p">(</span><span class="n">kinetic_energy_operator_vec</span><span class="p">)</span></div>

<div class="viewcode-block" id="kinetic_energy_expectation_value"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.kinetic_energy_expectation_value">[docs]</a><span class="k">def</span> <span class="nf">kinetic_energy_expectation_value</span><span class="p">(</span><span class="n">psi0_values</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi0_values : np.array</span>
<span class="sd">        The wave-function values in a vector.</span>
<span class="sd">    z : float</span>
<span class="sd">        The spatial grid vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">         It returns the value of the Kinetic Energy expectation value.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">to_1D_vec</span><span class="p">(</span><span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">T_exp</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">to_column_vec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi0_values</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">to_column_vec</span><span class="p">(</span><span class="n">kinetic_energy_operator</span><span class="p">(</span><span class="n">psi0_values</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="c1"># integrand = to_1D_vec(np.conj(psi0_values))*to_1D_vec(kinetic_energy_operator(psi0_values,z))</span>
    <span class="c1"># T_exp = np.trapz(integrand,to_1D_vec(z))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">T_exp</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">T_exp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1E-10</span><span class="p">:</span>
        <span class="n">T_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">T_exp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">T_exp</span><span class="p">))</span></div>

<div class="viewcode-block" id="initial_momentum_yair"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.initial_momentum_yair">[docs]</a><span class="k">def</span> <span class="nf">initial_momentum_yair</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sigma : float/int</span>
<span class="sd">        Standard deviation in spatial grid for the gaussin wave function.</span>
<span class="sd">    E0 : float/int</span>
<span class="sd">        Initial Energy. Usually stands for the energy value of an electorn located at the bootom of the</span>
<span class="sd">        conduction band.</span>
<span class="sd">    L : float/int</span>
<span class="sd">        The length of the system.</span>
<span class="sd">    z0 : float/int</span>
<span class="sd">        Initial position where the gaussian wave-packet is centered.</span>
<span class="sd">    A : float/int</span>
<span class="sd">        Normaliztion factor.</span>
<span class="sd">    T0 : float/int</span>
<span class="sd">        Initial Kinetic energy.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The initial momentum of an electorn.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">eqn</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">cons</span><span class="o">.</span><span class="n">hbarJ</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cons</span><span class="o">.</span><span class="n">me</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))))</span> <span class="o">*</span> \
          <span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">nps</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">L</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">+</span>
                                                                            <span class="n">nps</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">z0</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
              <span class="o">-</span><span class="p">((</span><span class="n">L</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span>
                                                  <span class="o">-</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="n">z0</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">z0</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                   <span class="mi">2</span><span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="n">z0</span><span class="p">))</span> <span class="o">-</span> <span class="n">T0</span>

    <span class="n">k0</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">eqn</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">real_sol</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">k0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">smp</span><span class="o">.</span><span class="n">re</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">real_sol</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">smp</span><span class="o">.</span><span class="n">re</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_sol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">real_sol</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">real_sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">real_sol</span> <span class="o">=</span> <span class="n">real_sol</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k0_for_psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_sol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You did not get any real solution for k0&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">real_sol</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">k0_for_psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k0_for_psi</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">k0_for_psi</span> <span class="o">=</span> <span class="n">k0_for_psi</span><span class="p">[</span><span class="n">k0_for_psi</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">k0_for_psi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>
    <span class="c1"># else:</span>
    <span class="c1">#     print(&#39;You did not get any real solution for the value of K0, instead K0 initialized with k0=0.1e10 [1/m]. Pay attention for this.&#39;)</span>
    <span class="c1">#     return np.float64(10)</span>

<div class="viewcode-block" id="find_closest_value_in_array"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_closest_value_in_array">[docs]</a><span class="k">def</span> <span class="nf">find_closest_value_in_array</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : int/float</span>
<span class="sd">        The value we wish to locate in the given array.</span>
<span class="sd">    arr : np.array</span>
<span class="sd">        The array in which we wish to find the index of the closest value.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int, float</span>
<span class="sd">        It returns an index of the closest value (An integer) . And the closest value, position (a float).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flag_num</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">flag_arr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">max_in_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_in_array</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">num</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">flag_num</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">num</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_in_array</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">flag_arr</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">num</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">dist</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">flag_arr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="n">n</span></div>

<div class="viewcode-block" id="to_2_column_mat"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.to_2_column_mat">[docs]</a><span class="k">def</span> <span class="nf">to_2_column_mat</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vec : `numpy.ndarray`</span>
<span class="sd">        The input vector we wish convert.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `numpy.ndarray`</span>
<span class="sd">        It retruns the input matrix in a form of 2 columns.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">vec</span></div>

<div class="viewcode-block" id="find_adjacent_minima_maxima"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_adjacent_minima_maxima">[docs]</a><span class="k">def</span> <span class="nf">find_adjacent_minima_maxima</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">start_peak_pos</span><span class="p">,</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Very not elegnat and very complex method to find adjacent minima to maxima point in a locpot vector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    v : np.array</span>
<span class="sd">        The local potential vector.</span>
<span class="sd">    start_peak_pos : float</span>
<span class="sd">        The initial position where to start seaching for the minima point.</span>
<span class="sd">    reverse : bool, optional, default: None</span>
<span class="sd">        It enables to look for maxima to minima adjacent points. (The reverse order).</span>
<span class="sd">    prominence : float, optional, default: None</span>
<span class="sd">        The prominence of the peak. It helps to detemine what peaks we wish relate during the calculation.</span>
<span class="sd">        For more inforamtion about this mathematical entity it is recommended to look for it on web (it has to be with topology in mathematics)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (int, float), (int, float)</span>
<span class="sd">        It returns the values of the index and the position of the minima and maxima points with respect to the order in the</span>
<span class="sd">        reverse flag. If not supplied, the first index,position pair regards the minima point and the second index,position pair</span>
<span class="sd">        regards the maxima points. Otherwise - it is returned in the reveresed order. index - is an integer, and position is a float.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">maxima_global</span> <span class="o">=</span> <span class="n">find_peaks_maxima</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">ignore_local_maxima</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxima_global</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">minima_global</span> <span class="o">=</span> <span class="n">find_peaks_minima</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">ignore_local_minima</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="n">get_prominence</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">num_of_min</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minima_global</span> <span class="o">=</span> <span class="n">find_peaks_minima</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">ignore_local_minima</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">minima_tot</span> <span class="o">=</span> <span class="n">find_peaks_minima</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">ignore_local_minima</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">maxima_tot</span> <span class="o">=</span> <span class="n">find_peaks_maxima</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">ignore_local_maxima</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">minima_z_global</span> <span class="o">=</span> <span class="n">minima_global</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">minima_v_global</span><span class="o">=</span> <span class="n">minima_global</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">maxima_z_global</span> <span class="o">=</span> <span class="n">maxima_global</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">maxima_v_global</span> <span class="o">=</span> <span class="n">maxima_global</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">minima_z_tot</span> <span class="o">=</span> <span class="n">minima_tot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">minima_v_tot</span><span class="o">=</span> <span class="n">minima_tot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">maxima_z_tot</span> <span class="o">=</span> <span class="n">maxima_tot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">maxima_v_tot</span> <span class="o">=</span> <span class="n">maxima_tot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">ind_max</span><span class="p">,</span> <span class="n">pos_max</span> <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">start_peak_pos</span><span class="p">,</span> <span class="n">maxima_z_tot</span><span class="p">)</span>
    <span class="n">ind_min</span><span class="p">,</span> <span class="n">pos_min</span> <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">start_peak_pos</span><span class="p">,</span>
                                                   <span class="n">minima_z_global</span><span class="p">)</span>  <span class="c1"># assumes that the sub-peaks are being gotten at the maxima peaks exclusively.</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">maxima_z_global</span> <span class="o">==</span> <span class="n">maxima_z_tot</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">minima_z_tot</span> <span class="o">==</span> <span class="n">minima_z_global</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">minima_z_tot</span><span class="p">[</span><span class="n">minima_z_tot</span> <span class="o">&lt;</span> <span class="n">maxima_z_global</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="p">)</span> <span class="p">,</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">maxima_z_global</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxima_z_global</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">maxima_z_global</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">),</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span>
                    <span class="n">minima_z_tot</span><span class="p">[</span><span class="n">minima_z_tot</span> <span class="o">&gt;</span> <span class="n">maxima_z_global</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">z</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">maxima_z_global</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">)</span> <span class="p">,</span><span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">minima_z_tot</span><span class="p">[</span><span class="n">minima_z_tot</span> <span class="o">&gt;</span> <span class="n">maxima_z_global</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">z</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">pos_min_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">pos_min</span> <span class="o">&lt;</span> <span class="n">pos_max</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pos_min</span> <span class="ow">in</span> <span class="n">pos_min_list</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">ind_min</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">minima_z_global</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ind_min</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="n">pos_min_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minima_z_global</span><span class="p">[</span><span class="n">ind_min</span><span class="p">])</span>
                    <span class="n">pos_min</span> <span class="o">=</span>  <span class="n">minima_z_global</span><span class="p">[</span><span class="n">ind_min</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ind_min</span> <span class="o">-=</span><span class="mi">1</span>
                    <span class="n">pos_min</span> <span class="o">=</span> <span class="n">minima_z_global</span><span class="p">[</span><span class="n">ind_min</span><span class="p">]</span>
                    <span class="n">ind_max</span><span class="p">,</span> <span class="n">pos_max</span> <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">maxima_z_tot</span><span class="p">)</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">pos_min</span> <span class="o">-</span> <span class="n">pos_max</span>
            <span class="k">while</span> <span class="n">pos_min</span> <span class="o">&gt;</span> <span class="n">pos_max</span> <span class="ow">and</span> <span class="n">ind_max</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxima_z_tot</span><span class="p">):</span>
                <span class="n">ind_max</span> <span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">ind_max</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxima_z_tot</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pos_max</span> <span class="o">=</span> <span class="n">maxima_z_tot</span><span class="p">[</span><span class="n">ind_max</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pos_min</span> <span class="o">-</span> <span class="n">pos_max</span><span class="p">):</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">pos_min</span> <span class="o">-</span> <span class="n">pos_max</span>
            <span class="k">return</span>  <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="p">,</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">pos_max</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos_min_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">pos_min</span> <span class="o">&gt;</span> <span class="n">pos_max</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">pos_min</span> <span class="ow">in</span> <span class="n">pos_min_list</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">ind_min</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ind_min</span> <span class="o">-=</span><span class="mi">1</span>
                    <span class="n">pos_min_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minima_z_global</span><span class="p">[</span><span class="n">ind_min</span><span class="p">])</span>
                    <span class="n">pos_min</span> <span class="o">=</span>  <span class="n">minima_z_global</span><span class="p">[</span><span class="n">ind_min</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ind_min</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">ind_min</span> <span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">minima_z_global</span><span class="p">):</span>
                        <span class="n">pos_min</span> <span class="o">=</span> <span class="n">minima_z_global</span><span class="p">[</span><span class="n">ind_min</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">pos_min_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_min</span><span class="p">)</span>
                    <span class="n">ind_max</span><span class="p">,</span> <span class="n">pos_max</span> <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span> <span class="n">maxima_z_tot</span><span class="p">)</span>
            <span class="n">dist</span> <span class="o">=</span>  <span class="n">pos_max</span> <span class="o">-</span> <span class="n">pos_min</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">pos_max</span> <span class="o">&gt;</span> <span class="n">pos_min</span> <span class="ow">and</span> <span class="n">ind_max</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ind_max</span> <span class="o">-=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ind_max</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxima_z_tot</span><span class="p">):</span>
                    <span class="n">pos_max</span> <span class="o">=</span> <span class="n">maxima_z_tot</span><span class="p">[</span><span class="n">ind_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pos_max</span> <span class="o">=</span> <span class="n">maxima_z_tot</span><span class="p">[</span><span class="n">ind_max</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">pos_max</span> <span class="o">-</span> <span class="n">pos_min</span><span class="p">:</span>
                    <span class="n">dist</span> <span class="o">=</span>  <span class="n">pos_max</span> <span class="o">-</span> <span class="n">pos_min</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">pos_max</span><span class="p">,</span><span class="n">z</span><span class="p">),</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">pos_min</span><span class="p">,</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="force_psi_units"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.force_psi_units">[docs]</a><span class="k">def</span> <span class="nf">force_psi_units</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi : np.array</span>
<span class="sd">        The vector of the wave-function values to be forced into the desired units.</span>
<span class="sd">    units : str, {&#39;Meter&#39;, &#39;Angstrum&#39;], optioanl, default: &#39;Meter&#39;</span>
<span class="sd">         The choices are in the brackets. It defines the units of the normilization factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        It returns a vector of the Wave-function values in the desired units.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psi</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Meter&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
             <span class="n">psi</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">3.65</span><span class="p">:</span>
             <span class="n">psi</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;Angstrum&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
             <span class="n">psi</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-10</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">3.65</span><span class="p">:</span>
             <span class="n">psi</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1E-5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi</span> <span class="o">=</span>  <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">psi</span></div>

<div class="viewcode-block" id="run_one_time_step"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.run_one_time_step">[docs]</a><span class="k">def</span> <span class="nf">run_one_time_step</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">z</span> <span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave_function : np.array</span>
<span class="sd">        Wave function values vector to be propagated.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        dt. time step in which we wish perform the propagation proccess</span>
<span class="sd">    v : np.array</span>
<span class="sd">        Should be as the same size as `wave_function` vector.</span>
<span class="sd">        This is the local potential vector.</span>
<span class="sd">    z : np.array.</span>
<span class="sd">        Should be as the same size as `wave_function` vector.</span>
<span class="sd">        This is the spatial coordinates vector.</span>
<span class="sd">    k : np.array.</span>
<span class="sd">        Should be as the same size as `wave_function` vector.</span>
<span class="sd">        This the `k grid` axis vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np. array</span>
<span class="sd">        It returns a vector of the one time-step propagated wave-fucntion.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">time_step</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">fs2sec</span><span class="p">(</span><span class="n">time_step</span><span class="p">)</span>
    <span class="n">wave_function</span> <span class="o">=</span> <span class="n">force_psi_units</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">wave_function</span><span class="p">,</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">wave_function</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">wave_function</span><span class="p">),</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.97</span> <span class="o">&lt;=</span> <span class="n">temp</span> <span class="o">&lt;=</span> <span class="mf">1.03</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Psi was not normalized, Now it forces again normalization&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">wave_function</span> <span class="o">=</span> <span class="n">wave_function</span> <span class="o">*</span> <span class="n">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">wave_function</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;Meter&#39;</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">v</span> <span class="o">*</span> <span class="n">time_step</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cons</span><span class="o">.</span><span class="n">hbarJ</span><span class="p">))</span> <span class="o">*</span> <span class="n">wave_function</span>
    <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">temp_wave_function</span><span class="p">)</span>
    <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">cons</span><span class="o">.</span><span class="n">hbarJ</span> <span class="o">*</span> <span class="n">time_step</span> <span class="o">*</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cons</span><span class="o">.</span><span class="n">me</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">temp_wave_function</span>
    <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">temp_wave_function</span><span class="p">)</span>
    <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">v</span> <span class="o">*</span> <span class="n">time_step</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cons</span><span class="o">.</span><span class="n">hbarJ</span><span class="p">))</span> <span class="o">*</span> <span class="n">temp_wave_function</span>
    <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">force_psi_units</span><span class="p">(</span><span class="n">temp_wave_function</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;Meter&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_normalized</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">temp_wave_function</span><span class="p">,</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Meter&#39;</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">temp_wave_function</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">temp_wave_function</span><span class="p">),</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.97</span> <span class="o">&lt;=</span> <span class="n">temp</span> <span class="o">&lt;=</span> <span class="mf">1.03</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Psi after propagation was not normalized, Now it forces again normalization&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">temp_wave_function</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">temp_wave_function</span><span class="p">),</span> <span class="n">z</span><span class="p">)))</span>
            <span class="n">temp_wave_function</span> <span class="o">=</span> <span class="n">temp_wave_function</span> <span class="o">*</span> <span class="n">normalize_wave_function_numerically</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">temp_wave_function</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;Meter&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp_wave_function</span></div>

<div class="viewcode-block" id="calculate_probability_current"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.calculate_probability_current">[docs]</a><span class="k">def</span> <span class="nf">calculate_probability_current</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave_function : np.array</span>
<span class="sd">        wave function values vector to be propagated.</span>
<span class="sd">    k : np.array.</span>
<span class="sd">        Should be as the same size as wave_function vector.</span>
<span class="sd">        This is the `k grid` axis vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        It returns the probabilty current.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">d_wave_function</span> <span class="o">=</span> <span class="n">fft_first_drivative</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">c_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)</span>
    <span class="n">c_d_wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">d_wave_function</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cons</span><span class="o">.</span><span class="n">hbarJ</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cons</span><span class="o">.</span><span class="n">me</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span> <span class="n">c_wave_function</span> <span class="o">*</span> <span class="n">d_wave_function</span> <span class="o">-</span> <span class="n">wave_function</span> <span class="o">*</span> <span class="n">c_d_wave_function</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span></div>

<div class="viewcode-block" id="fft_first_drivative"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.fft_first_drivative">[docs]</a><span class="k">def</span> <span class="nf">fft_first_drivative</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave_function : np.array</span>
<span class="sd">        The wave function values vector to be propagated.</span>
<span class="sd">    k : np.array</span>
<span class="sd">        Should be as the same size as `wave_function` vector.</span>
<span class="sd">        This is the `k-grid` axis vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array</span>
<span class="sd">        It returns the first derivative of the wave_function</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">wave_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wave_function</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wave_function</span></div>

<div class="viewcode-block" id="cumulative_probabilty"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.cumulative_probabilty">[docs]</a><span class="k">def</span> <span class="nf">cumulative_probabilty</span><span class="p">(</span><span class="n">wave_function</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z_cutoff</span><span class="p">,</span> <span class="n">dz</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave_function : np.array</span>
<span class="sd">        The Wave function values vector to be propagated.</span>
<span class="sd">    z : np.array</span>
<span class="sd">        The z spatial coordinates vector</span>
<span class="sd">    z_cutoff : float</span>
<span class="sd">        The maximum value of to calculate the accumulated probability.</span>
<span class="sd">    dz : float</span>
<span class="sd">        The spatial gird differnce between points.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The `cumulative_probabilty` value up to certain ``z`` value coordinate.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">z_axis</span> <span class="o">=</span> <span class="n">z</span> <span class="o">&gt;=</span> <span class="n">z_cutoff</span>
    <span class="n">cut_wave_function</span> <span class="o">=</span> <span class="n">wave_function</span><span class="p">[</span><span class="n">z_axis</span><span class="p">]</span>
    <span class="n">cum_probability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cut_wave_function</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">cut_wave_function</span><span class="p">)</span> <span class="o">*</span> <span class="n">dz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cum_probability</span></div>

<div class="viewcode-block" id="transmision_coeff"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.transmision_coeff">[docs]</a><span class="k">def</span> <span class="nf">transmision_coeff</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span><span class="n">Nt</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">z_position</span><span class="p">,</span><span class="n">path_to_save</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">final_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Integration for the all time of simulation, summing all the probabilty currents, for each time-step in the simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi0 : np.array</span>
<span class="sd">        The wave function values vector.</span>
<span class="sd">    Nt : int</span>
<span class="sd">        The number of time-step that are being made.</span>
<span class="sd">    dt : float</span>
<span class="sd">        The time-step magnitude.</span>
<span class="sd">    v : np.array</span>
<span class="sd">        The local potential vector.</span>
<span class="sd">    z : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    k : np.array</span>
<span class="sd">        K grid vector.</span>
<span class="sd">    z_position : float</span>
<span class="sd">        The position at which it calculates the transimission coefficient. Should</span>
<span class="sd">        be given in units of Meter.</span>
<span class="sd">    path_to_save : string, optional, default:None</span>
<span class="sd">        The absolute path to save the figure obtained from the calculation</span>
<span class="sd">    final_time : float, optional, default:None</span>
<span class="sd">        The top boundary for the integration as we can integrate until this given time of the simulation. It stands for **t_f**</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        It returns the calculated transmission coefficient.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">integrate_trapz</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">to_1D_vec</span><span class="p">(</span><span class="n">vector</span><span class="p">)),</span> <span class="n">dx</span><span class="o">=</span><span class="n">df</span><span class="p">)))</span>
    <span class="n">psi0</span> <span class="o">=</span> <span class="n">force_psi_units</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Meter&#39;</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">fs2sec</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">Nt</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">eV2J</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z_position</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z_position</span><span class="p">)</span>
    <span class="n">z_ind</span><span class="p">,</span> <span class="n">z_pos</span>  <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">z_position</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">z_axis</span> <span class="o">=</span> <span class="n">z</span> <span class="o">==</span> <span class="n">z_pos</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">temp_psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">psi0</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">temp_psi</span> <span class="o">=</span> <span class="n">psi0</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Entering the main  propagation for the trans. Coff calculation&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">calculate_probability_current</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span><span class="n">k</span><span class="p">)[</span><span class="n">z_axis</span><span class="p">])]</span>
            <span class="n">temp_psi</span> <span class="o">=</span> <span class="n">run_one_time_step</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span><span class="n">z</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">calculate_probability_current</span><span class="p">(</span><span class="n">temp_psi</span><span class="p">,</span><span class="n">k</span><span class="p">)[</span><span class="n">z_axis</span><span class="p">])]</span>
            <span class="n">temp_psi</span> <span class="o">=</span> <span class="n">run_one_time_step</span><span class="p">(</span><span class="n">temp_psi</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span><span class="n">z</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nt</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;++++++++++++++++++++++++++++++++++&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reached iteration </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;++++++++++++++++++++++++++++++++++&#39;</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Cumulative Probabilty Through the interface and Transmission coefficient&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">useMathText</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time simulation, in fsec&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative probabilty through the interface&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">final_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">final_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">sec2fs</span><span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span>
                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Probabilty current $J_{{z=z_{{interface}}}}$, Transmission coefficient is : </span><span class="si">{:.5f}</span><span class="s1"> $\frac{{e}}{{\AA}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">results</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ind_time</span><span class="p">,</span> <span class="n">pos_time</span> <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">sec2fs</span><span class="p">(</span><span class="n">final_time</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">sec2fs</span><span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">))))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">sec2fs</span><span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Probabilty current $J_{{z=z_{{interface}}}}$, Transmission coefficient is : </span><span class="si">{:.5f}</span><span class="s1"> $\frac{{e}}{{\AA}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">results</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])[</span><span class="n">ind_time</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">sec2fs</span><span class="p">(</span><span class="n">pos_time</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">path_to_save</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Probabilty current, Transmission coefficient.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="s1">&#39;Probabilty current, Transmission coefficient.svg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;.svg&quot;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">results</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="adjust_grid_density"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.adjust_grid_density">[docs]</a><span class="k">def</span> <span class="nf">adjust_grid_density</span><span class="p">(</span><span class="n">density</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    density : float</span>
<span class="sd">        The grid density. A quantity that was determined through the convergence tests and is the number</span>
<span class="sd">        of the space steps divided by the length of the system.</span>
<span class="sd">    z : np.array</span>
<span class="sd">        The spatial coordinates vector.</span>
<span class="sd">    v : np.array</span>
<span class="sd">        The local potntial vector along the system.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        It returns the new spatial coordinate vecor as z, and the new local potneital vector as v.</span>
<span class="sd">        They have been adjusted to the defined grid density supplied.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="n">density</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">A2m</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="n">density</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">z</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">interpolate_pchip</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span><span class="p">,</span><span class="n">v</span></div>

<div class="viewcode-block" id="reach_plateau"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.reach_plateau">[docs]</a><span class="k">def</span> <span class="nf">reach_plateau</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">critiria_plat</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="n">tol_2</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The independent variable, usually will be the spatial grid vector or time space vector.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The dependent variable. The matching value of a function to the respective x value. Can be the comulative probabilty.</span>
<span class="sd">    critiria_plat : float. optional, default: 0.0001</span>
<span class="sd">        The value we decide to relate as no change in slope to determine the plateau region. The closer to zero</span>
<span class="sd">        the stricter critiria.</span>
<span class="sd">    tol_2 :  float. optional, default: 0.005</span>
<span class="sd">        The value we decide to relate as no change in values of the cumulative probabilty. The smaller value -</span>
<span class="sd">        the stricter critiria.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        It checks whether we reached plateau, namely steady-state according to the vector supplied.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">40</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">par</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">par</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span><span class="o">+</span><span class="n">par</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">first_der</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_last_part</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)):]</span>
    <span class="n">x_last_part</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)):]</span>
    <span class="n">first_der_last_part</span> <span class="o">=</span> <span class="n">first_der</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))):]</span>
    <span class="n">critiria</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">critiria_plat</span><span class="p">)</span>
    <span class="n">linreg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">lin_reg</span><span class="p">(</span><span class="n">x_last_part</span><span class="p">,</span><span class="n">y_last_part</span><span class="p">)</span><span class="o">.</span><span class="n">slope</span><span class="p">)</span>
    <span class="n">first_der_last_part</span> <span class="o">=</span> <span class="n">first_der</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))):]</span>
    <span class="n">flag_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">linreg</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">critiria</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_last_part</span><span class="p">))</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_straight_line</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">flag_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])))</span> <span class="o">&lt;=</span> <span class="n">tol_2</span> <span class="ow">and</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span><span class="o">-</span><span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])))</span> <span class="o">&lt;=</span> <span class="n">tol_2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]))</span><span class="o">-</span><span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">])))</span> <span class="o">&lt;=</span> <span class="n">tol_2</span>
    <span class="k">return</span> <span class="n">flag_1</span> <span class="ow">and</span> <span class="n">flag_2</span></div>

<div class="viewcode-block" id="is_straight_line"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.is_straight_line">[docs]</a><span class="k">def</span> <span class="nf">is_straight_line</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check if the input vector repesents a straight line</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The vector values we wish to check.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        It returns whether the input vector is a straight line or not.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>

<div class="viewcode-block" id="find_interface"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.find_interface">[docs]</a><span class="k">def</span> <span class="nf">find_interface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is a method that was duplicated from LOCPOT Class. It also appears there.</span>
<span class="sd">    It helps when we wish to allocate the interface position of the system,</span>
<span class="sd">    but have not created a locpot class instance.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        It stands for the spatial coordinates array.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The local potential vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int, float</span>
<span class="sd">        It returns the interface index in the locpot vector, and its `z` position</span>
<span class="sd">        If the system does not contain an interface, it just returns the last spatial grid coordinate position</span>
<span class="sd">        and its corresponded index. -&gt; [index,position] ==&gt; [len(z)-1,z[-1]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">diff2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">zz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">num_of_peaks</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">num_of_peaks</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">iterations</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">iterations</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">peaks_step_2</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">peaks_step_2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="n">peaks_step_2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">zzz</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">diff2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">zzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zzz</span><span class="p">,</span> <span class="n">zz</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">num_of_peaks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff2</span><span class="p">)</span>
        <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">iterations</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num_of_peaks</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">peaks_step_2</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">zzz</span><span class="p">,</span> <span class="n">diff2</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks_step_2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">diff</span> <span class="o">=</span> <span class="n">peaks_step_2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">zz</span> <span class="o">=</span> <span class="n">peaks_step_2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">zzz</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">diff2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">diff2</span> <span class="o">=</span> <span class="n">diff</span>
                    <span class="n">zzz</span> <span class="o">=</span> <span class="n">zzz</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; It did not find an interface, instead you will treat the end of the locpot as an interface&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff2</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">diff2</span><span class="p">))</span>
        <span class="n">z_interface</span> <span class="o">=</span> <span class="n">zzz</span><span class="p">[</span><span class="n">max_value</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">z_interface</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="integrate_trapz"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.integrate_trapz">[docs]</a><span class="k">def</span> <span class="nf">integrate_trapz</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vector : np.array</span>
<span class="sd">        The vector we wish the integrate numerically.</span>
<span class="sd">    df : float</span>
<span class="sd">        The step difference between adjacent steps. It assumes the the vector is spaced evenlly.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The numerical intgration result.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">to_1D_vec</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="n">df</span><span class="p">))</span></div>

<div class="viewcode-block" id="plateau_val"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.plateau_val">[docs]</a><span class="k">def</span> <span class="nf">plateau_val</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">critiria</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : np.array</span>
<span class="sd">        The spatial coordinates array.</span>
<span class="sd">    y : np.array</span>
<span class="sd">        The relevent functional values that corresponds the spatial coordinates vector.</span>
<span class="sd">    critiria : float, optional, default: 0.0001</span>
<span class="sd">        It can be changed for more of less strict evalutaion where the plateau has come.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        It returns the average value of the points that the plateau spread on.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">to_1D_vec</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reach_plateau</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">critiria_plat</span> <span class="o">=</span> <span class="n">critiria</span><span class="p">):</span>
        <span class="n">first_der</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_last_part</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span> <span class="mf">0.98</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">)):]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_last_part</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">y_last_part</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="mf">0.95</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))):]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_last_part</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">y_last_part</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="mf">0.85</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))):]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_last_part</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="n">y_last_part</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="mf">0.75</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))):]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">y_last_part</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="mf">0.6667</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))):]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">y_last_part</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#print(&#39;The input vector has not reached plateau&#39;)</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="is_peak_minimum"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.is_peak_minimum">[docs]</a><span class="k">def</span> <span class="nf">is_peak_minimum</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">peak</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Pay attention - the peak is within the range of the peaks and not at its edges.</span>
<span class="sd">    Otherwise it will raise an index out-of-range error.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    peaks : `numpt.ndarray`, (N,2)</span>
<span class="sd">        The first column stands for the spatial poisition of the peaks.</span>
<span class="sd">        The second column is for the height of the peaks.</span>
<span class="sd">    peak : list: [int,float,float]</span>
<span class="sd">        The first argument is for the index of the peak inside the peaks array,</span>
<span class="sd">        The second argument is for the position of the peak. The third argument is for the height of the peak.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        This function checks whether a given peak is a minimum point. (or at least a local minimum).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">])])):</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">flag</span></div>



<div class="viewcode-block" id="is_peak_maximum"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.is_peak_maximum">[docs]</a><span class="k">def</span> <span class="nf">is_peak_maximum</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">peak</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Pay attention - the peak is within the range of the peaks and not at its edges.</span>
<span class="sd">    Otherwise it will raise an index out-of-range error.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    peaks : `numpy.ndarray`, (N,2)</span>
<span class="sd">        The first column stands for the spatial poisition of the peaks.</span>
<span class="sd">        The second column is for the height of the peaks.</span>
<span class="sd">    peak : list: [int,float,float]</span>
<span class="sd">        The first argument is for the index of the peak inside the peaks array,</span>
<span class="sd">        The second argument is for the position of the peak. The third argument is for the height of the peak.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        This function checks whether a given peak is a maximum point. (or at least a local maximum).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">])])):</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="is_peak_maximum_2"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.is_peak_maximum_2">[docs]</a><span class="k">def</span> <span class="nf">is_peak_maximum_2</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">peak_pos</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Pay attention - the peak is within the range of the peaks and not at its edges.</span>
<span class="sd">    Otherwise it will raise an index out-of-range error.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        This function checks whether a given peak is a maximum point. (or at least a local maximum).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ind_peak</span><span class="p">,</span><span class="n">pos_peak</span> <span class="o">=</span> <span class="n">find_closest_value_in_array</span><span class="p">(</span><span class="n">peak_pos</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind_peak</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ind_peak</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="o">+</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">flag</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">elif</span> <span class="n">ind_peak</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">flag</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">elif</span> <span class="n">ind_peak</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">ind_peak</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_peak</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">promin</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">peak_prominences</span><span class="p">(</span><span class="n">v</span><span class="p">,[</span><span class="n">ind_peak</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">promin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="r_sqrd"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.r_sqrd">[docs]</a><span class="k">def</span> <span class="nf">r_sqrd</span><span class="p">(</span><span class="n">v_original</span><span class="p">,</span> <span class="n">v_fitted</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calculates the R square fitting parameter between two vectors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v_original : np.array</span>
<span class="sd">        The vector contains the values whom we wish to compare to.</span>
<span class="sd">    v_fitted : np.array</span>
<span class="sd">        The vector contains the values whom we wish to fit .</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The calculated R sqrd value.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_1D_vec</span><span class="p">(</span><span class="n">v_original</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_1D_vec</span><span class="p">(</span><span class="n">v_fitted</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">v_original</span> <span class="o">-</span> <span class="n">v_fitted</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">v_original</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_original</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span></div>

<div class="viewcode-block" id="smooth_function"><a class="viewcode-back" href="../Help_function_library_yair.html#Help_function_library_yair.smooth_function">[docs]</a><span class="k">def</span> <span class="nf">smooth_function</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calculates the R square fitting parameter between two vectors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z : np.array</span>
<span class="sd">        The spatial coordinates array.</span>
<span class="sd">    v : np.array</span>
<span class="sd">        The relevent function&#39;s values that corresponds the spatial coordinates vector.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.array, np.array</span>
<span class="sd">        This function returns the smoothed local potential vector with the corresponding spatial coordinates.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flag_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">z</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
    <span class="n">flag_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">m2A</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">J2eV</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">window</span><span class="o">*</span><span class="mf">0.0000001</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">window</span> <span class="o">*=</span><span class="mi">10</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v_temp</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">v_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">r_sqrd</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_temp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.96</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v_temp</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v_temp</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">v_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">r_sqrd</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_temp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.96</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v_temp</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">window</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">iteration</span> <span class="o">+=</span><span class="mi">1</span>


    <span class="n">z</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">interpolate_pchip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="mf">0.8</span><span class="p">),</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    <span class="n">z</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate_pchip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">),</span> <span class="n">z</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span><span class="p">,</span><span class="n">v</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, MCT&amp;YairR&amp;NadavS

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>